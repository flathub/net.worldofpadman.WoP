app-id: net.worldofpadman.WoP
tags:
  - proprietary
runtime: org.freedesktop.Platform
runtime-version: 24.08
sdk: org.freedesktop.Sdk
command: worldofpadman
finish-args:
  # Controller support
  - --device=all
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --persist=.padman
cleanup:
  - /man
  - /include
  - /share/man
  - /doc
  - '*.a'
  - '*.la'
modules:
  - name: wop
    buildsystem: autotools
    no-autogen: true
    no-make-install: true
    make-args:
      - BUILD_RENDERER_VULKAN=0
    sources:
      - type: archive
        # Community url, however SHA256 checksum matches the official archive from Mod DB
        url: https://github.com/PadWorld-Entertainment/worldofpadman/releases/download/v1.7.0/wop-1.7.0-unified.zip
        sha256: 2eb94c0d98dadc70ce0f2e87780280cdbffd4a838b267f523835dc91bed30714
      - type: git
        url: https://github.com/PadWorld-Entertainment/worldofpadman.git
        tag: v1.7.0
        commit: 8da7d0eb7205a2a1dff3f8cb07010214337796e2
        x-checker-data:
          type: git
          tag-pattern: ^(v[\d.]+)$
      - type: file
        path: net.worldofpadman.WoP.desktop
      - type: file
        path: net.worldofpadman.WoP.svg
      - type: file
        path: net.worldofpadman.WoP.metainfo.xml
      - type: script
        commands:
          - exec /app/share/games/wop/wop.* "$@"
        dest-filename: worldofpadman
      - type: shell
        commands:
          - rm *.x86_64 *.exe *.so *.dylib
          - rm -r *.x86_64.app
    post-install:
      - mkdir -p /app/share/games/wop
      - install -m 0755 build/release-linux-*/wop.* /app/share/games/wop/
      - install -m 0755 build/release-linux-*/renderer_opengl1_*.so /app/share/games/wop/
      - install -m 0755 build/release-linux-*/renderer_opengl2_*.so /app/share/games/wop/
      - cp -r wop /app/share/games/wop/wop
      - install -Dm755 worldofpadman /app/bin/worldofpadman
      - install -Dm644 net.worldofpadman.WoP.desktop /app/share/applications/net.worldofpadman.WoP.desktop
      - install -Dm644 net.worldofpadman.WoP.svg /app/share/icons/hicolor/scalable/apps/net.worldofpadman.WoP.svg
      - install -Dm644 net.worldofpadman.WoP.metainfo.xml /app/share/metainfo/net.worldofpadman.WoP.metainfo.xml
